# JSON
Read this guide to learn how to configure DQOps to use JSON files from the UI, command-line, or directly in YAML files. All parameters are documented.

## Overview

You can utilize JSON files stored either locally or remotely in a cloud storage. 

The input table is generated by specifying either single or multiple files, or a directory containing JSON files.

## Prerequisite credentials

Additional configuration is required **only for using remote storage** (AWS S3).

When using a remote cloud storage, ensure that your account has access to the remote directory containing JSON files.
The permissions acquired should enable the listing of files and directories, as well as reading the content of files.

## Add JSON connection using the user interface

### **Navigate to the connection settings**

To navigate to the JSON connection settings:

1. Go to Data Sources section and click **+ Add connection** button in the upper left corner. // todo: screen

    ![Adding connection](https://dqops.com/docs/images/working-with-dqo/adding-connections/adding-connection.png)

2. Select JSON database type. // todo: screen

    ![Selecting JSON database type](https://dqops.com/docs/images/working-with-dqo/adding-connections/adding-connection-spark.png)


### **Fill in the connection settings**

After navigating to the JSON connection settings, you will need to fill in the connection details. // todo: screen

![Adding connection settings](https://dqops.com/docs/images/working-with-dqo/adding-connections/connection-settings-spark1.png)

| JSON connection settings    | Property name in YAML configuration file | Description                                                                                                                                                                                                                               | 
|-----------------------------|------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Connection name             |                                          | The name of the connection that will be created in DQOps. This will also be the name of the folder where the connection configuration files are stored. The name of the connection must be unique and consist of alphanumeric characters. |
| Parallel jobs limit         |                                          | New limit. Null value will disable limit.                                                                                                                                                                                                 |
| Storage type                | `storage-type`                             | Type of source files for DuckDB. The value can be in the ${ENVIRONMENT_VARIABLE_NAME} format to use dynamic substitution.                                                                                                                 |
| Source files type           | `source-files-type`                        | Type of source files for DuckDB. The value can be in the ${ENVIRONMENT_VARIABLE_NAME} format to use dynamic substitution.                                                                                                                 |
| JDBC connection property    |                                          | Optional setting. DQOps supports using JDBC driver to access DuckDB. [JDBC Concepts.](https://docs.oracle.com/en/database/oracle/oracle-database/23/jjdbc/introducing-JDBC.html).                                                         |
| User                        | `user`                                     | DuckDB user name for a remote storage type. The value can be in the ${ENVIRONMENT_VARIABLE_NAME} format to use dynamic substitution.                                                                                                      |
| Password                    | `password`                                 | DuckDB password for a remote storage type. The value can be in the ${ENVIRONMENT_VARIABLE_NAME} format to use dynamic substitution.                                                                                                       |
| Region                      | `region`                                   | The region for the storage credentials. The value can be in the ${ENVIRONMENT_VARIABLE_NAME} format to use dynamic substitution.                                                                                                          |
| Virtual schema name / Path  | `directories`                              | Virtual schema name to directory mappings. The path must be an absolute path.                                                                                                                                                             |


**JSON format specific settings**

The format properties of a JSON file are detected automatically based on a data sample from the file. The default sample size is 20480 rows.

For a very specific JSON format the following properties can be configured.

| JSON format specific settings | Property name in YAML configuration file | Description                                                                                                                                                                                   |
|------------------------------|------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Auto detect                 | `auto-detect`                              | Whether to auto-detect detect the names of the keys and data types of the values automatically.                                                                                                                                           | 
| Compression                 | `compression`                              | The compression type for the file. By default this will be detected automatically from the file extension (e.g., t.json.gz will use gzip, t.json will use none). Options are none, gzip, zstd.                                            | 
| Dateformat                  | `dateformat`                               | Specifies the date format to use when parsing dates.                                                                                                                                                                                      | 
| Convert strings to integers | `convert-strings-to-integers`              | Whether strings representing integer values should be converted to a numerical type.                                                                                                                                                      | 
| Dateformat                  | `dateformat`                               | Specifies the date format to use when parsing dates.                                                                                                                                                                                      | 
| Filename                    | `filename`                                 | Whether or not an extra filename column should be included in the result.                                                                                                                                                                 | 
| Format                      | `format`                                   | Json format. Can be one of \['auto', 'unstructured', 'newline_delimited', 'array'\].                                                                                                                                                      | 
| Hive partitioning           | `hive-partitioning`                        | Whether or not to interpret the path as a hive partitioned path.                                                                                                                                                                          | 
| Ignore errors               | `ignore-errors`                            | Option to ignore any parsing errors encountered - and instead ignore rows with errors.                                                                                                                                                    | 
| Maximum depth               | `maximum-depth`                            | Maximum nesting depth to which the automatic schema detection detects types. Set to -1 to fully detect nested JSON types.                                                                                                                 | 
| Maximum object size         | `maximum-object-size`                      | The maximum size of a JSON object (in bytes).                                                                                                                                                                                             | 
| Records                     | `records`                                  | Can be one of ['auto', 'true', 'false'].                                                                                                                                                                                                  | 
| Sample size                 | `sample-size`                              | The number of lines at the top of the file to skip.                                                                                                                                                                                       | 
| Timestamp format            | `timestampformat`                          | Specifies the date format to use when parsing timestamps.                                                                                                                                                                                 | 


### Environment variables in parameters

DQOps allows you to dynamically replace properties in connection settings with environment variables. To use it, simply
change "clear text" to ${ENV_VAR} using the drop-down menu at the end of the variable entry field and type your variable.

For example:

![Adding connection settings - environmental variables](https://dqops.com/docs/images/working-with-dqo/adding-connections/connection-settings-envvar.jpg)

To add optional JDBC connection properties just type the **JDBC connection property** and the **Value**. The value
can be in the ${ENVIRONMENT_VARIABLE_NAME} format to use dynamic substitution.

For example:

![Adding connection JDBC settings](https://dqops.com/docs/images/working-with-dqo/adding-connections/connection-settings-JDBC-properties.jpg)

To remove the property click on the trash icon at the end of the input field.

After filling in the connection settings, click the **Test Connection** button to test the connection.

Click the **Save** connection button when the test is successful otherwise you can check the details of what went wrong.


### **Import metadata using the user interface**

When you add a new connection, it will appear in the tree view on the left, and you will be redirected to the Import Metadata screen.
Now we can import JSON files.

1. Import the selected virtual schemas by clicking on the **Import Tables** button next to
   the name of the source schema from which you want to import tables.

   ![Importing schemas](https://dqops.com/docs/images/working-with-dqo/adding-connections/importing-schemas.png)

2. Select the tables (folders with JSON files or just the files) you want to import or import all tables using the buttons in the upper right corner.

   ![Importing tables](https://dqops.com/docs/images/working-with-dqo/adding-connections/importing-tables.png)

When new tables are imported, DQOps automatically activates profiling and monitoring checks, such as row count,
table availability and checks detecting schema changes. These checks are scheduled to run daily at 12:00 p.m.
By clicking on the Advisor at the top of the page, you can quickly collect basic statistics, run profiling checks
or modify the schedule for newly imported tables.

![Importing tables - advisor](https://dqops.com/docs/images/working-with-dqo/adding-connections/importing-tables-advisor.png)


## Add JSON connection using DQOps Shell

To add a connection run the following command in DQOps Shell.

```
dqo> connection add
```

Fill in the data you will be asked for. 

Select the **duckdb** provider, which provides support for the JSON file format.

!!! info "Windows file system"

    When using the file system of Windows remember to put double backslash (\\) in a path on the CLI prompt.
    A single forward slash (/) can also be used.


```
Connection name (--name): connection1
Database provider type (--provider):
 [ 1] bigquery
 [ 2] databricks
 [ 3] mysql
 [ 4] oracle
 [ 5] postgresql
 [ 6] duckdb
 [ 7] presto
 [ 8] redshift
 [ 9] snowflake
 [10] spark
 [11] sqlserver
 [12] trino
Please enter one of the [] values: 6
Type of storage [local]:
 [ 1] local (default)
 [ 2] s3
Please enter one of the [] values: 
Type of source files for DuckDB:
 [ 1] csv
 [ 2] json
 [ 3] parquet
Please enter one of the [] values: 2
Virtual schema names and paths (in a pattern schema=path): files=/usr/share/clients_data
Connection connection1 was successfully added.
Run 'table import -c=connection1' to import tables.
```

You can also run the command with parameters to add a connection in just a single step.

```
dqo> connection add --name=connection1
--provider=duckdb
--duckdb-storage-type=local
--duckdb-source-files-type=json
--duckdb-directories=files=/usr/share/clients_data
```

After adding connection run `table import -c=connection1` to select schemas and import tables.

DQOps will ask you to select the schema from which the tables will be imported.

You can also add the schema and table name as a parameter to import tables in just a single step.

```
dqo> table import --connection={connection name}
--schema={virtual schema name}
--table={file or folder}
```


DQOps supports the use of the asterisk character * as a wildcard when selecting schemas and tables, which can substitute
any number of characters. For example, use  pub* to find all schema a name with a name starting with "pub". The *
character can be used at the beginning, in the middle or at the end of the name.

## Connections configuration files

Connection configurations are stored in the YAML files in the `./sources` folder. The name of the connection is also
the name of the folder where the configuration file is stored.

Below is a sample YAML file showing an example configuration of the JSON data source connection.

``` yaml
apiVersion: dqo/v1
kind: source
spec:
  provider_type: duckdb
  duckdb:
    read_mode: files
    source_files_type: csv
    directories:
      files: /usr/share/clients_data
    storage_type: local
```

### **Reference of all connection parameters**
The complete documentation of all connection parameters used in the `spec.duckdb` node is
described in the reference of the [DuckdbParametersSpec](../reference/yaml/ConnectionYaml.md#duckdbparametersspec)
YAML files format reference.

## Next steps

- We have provided a variety of use cases which use openly available datasets [Google Cloud](https://cloud.google.com/datasets) to help you in using DQOps effectively. You can find the [full list of use cases here](../examples/index.md).
- DQOps allows you to keep track of the issues that arise during data quality monitoring and send alert notifications directly to Slack. Learn more about [incidents](../working-with-dqo/managing-data-quality-incidents-with-dqops.md) and [notifications](../integrations/webhooks/index.md).
- The data in the table often comes from different data sources and vendors or is loaded by different data pipelines. Learn how [data grouping in DQOps](../working-with-dqo/set-up-data-grouping-for-data-quality-checks.md) can help you to calculate separate data quality KPI scores for different groups of rows.